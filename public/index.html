<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Ethereum Node Stats</title>
    <style>
        body {
            font-family: Arial, sans-serif;
            margin: 20px;
            padding: 0;
        }
        table {
            width: 100%;
            border-collapse: collapse;
            margin-bottom: 20px;
        }
        th, td {
            border: 1px solid #ddd;
            padding: 8px;
            word-wrap: break-word;
            max-width: 200px;
        }
        th {
            background-color: #f2f2f2;
        }
        tr:hover {
            background-color: #f5f5f5;
        }
        @media screen and (max-width: 600px) {
            body {
                margin: 10px;
            }
            table, thead, tbody, th, td, tr {
                display: block;
            }
            th {
                position: absolute;
                top: -9999px;
                left: -9999px;
            }
            tr {
                border: 1px solid #ccc;
                margin-bottom: 5px;
            }
            td {
                border: none;
                border-bottom: 1px solid #eee;
                position: relative;
                padding-left: 50%;
            }
            td:before {
                position: absolute;
                top: 6px;
                left: 6px;
                width: 45%;
                padding-right: 10px;
                white-space: nowrap;
                font-weight: bold;
            }
            td:nth-of-type(1):before { content: "ID"; }
            td:nth-of-type(2):before { content: "Name"; }
            td:nth-of-type(3):before { content: "Enode"; }
            td:nth-of-type(4):before { content: "Local Address"; }
            td:nth-of-type(5):before { content: "Remote Address"; }
            td:nth-of-type(6):before { content: "Version"; }
            td:nth-of-type(7):before { content: "Caps"; }
            td:nth-of-type(8):before { content: "Inbound"; }
            td:nth-of-type(9):before { content: "Static"; }
            td:nth-of-type(10):before { content: "Trusted"; }
        }
    </style>
</head>
<body>
    <h1>Ethereum Node Stats</h1>
    <h2>Connected Peers</h2>
    <table>
        <thead>
            <tr>
                <th>ID</th>
                <th>Name</th>
                <th>Enode</th>
                <th>Local Address</th>
                <th>Remote Address</th>
                <th>Version</th>
                <th>Caps</th>
                <th>Inbound</th>
                <th>Static</th>
                <th>Trusted</th>
            </tr>
        </thead>
        <tbody id="peer-stats">
        </tbody>
    </table>
    <script>
        let socket = new WebSocket("ws://vc-ethereum-execution-0.vc-ethereum-execution-headless.mainnet.svc.cluster.local:3737/ws");
        socket.onmessage = function(event) {
            let peers = JSON.parse(event.data);
            let tbody = document.getElementById('peer-stats');
            tbody.innerHTML = '';

            peers.forEach(peer => {
                let row = document.createElement('tr');
                row.innerHTML = `
                    <td>${peer.id}</td>
                    <td>${peer.name}</td>
                    <td>${peer.enode}</td>
                    <td>${peer.network.localAddress}</td>
                    <td>${peer.network.remoteAddress}</td>
                    <td>${peer.protocols.eth.version}</td>
                    <td>${peer.caps.join(', ')}</td>
                    <td>${peer.inbound}</td>
                    <td>${peer.static}</td>
                    <td>${peer.trusted}</td>
                `;
                tbody.appendChild(row);
            });
        };

        socket.onclose = function(event) {
            if (event.wasClean) {
                console.log('Connection closed cleanly');
            } else {
                console.error('Connection died');
            }
        };

        socket.onerror = function(error) {
            console.error(`[error] ${error.message}`);
        };
    </script>
</body>
</html>
